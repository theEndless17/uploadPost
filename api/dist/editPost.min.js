"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=handler;var _mongoose=_interopRequireDefault(require("mongoose")),_db=require("../utils/db");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var postSchema=new _mongoose.default.Schema({message:String,timestamp:Date,username:String,sessionId:String,likes:{type:Number,default:0},dislikes:{type:Number,default:0},likedBy:[String],dislikedBy:[String],comments:[{username:String,comment:String,timestamp:Date}]}),Post=_mongoose.default.model("Post",postSchema),setCorsHeaders=function(e){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, PATCH, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type")};function handler(t,s){var r,a,n,o,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if("OPTIONS"===t.method)return setCorsHeaders(s),e.abrupt("return",s.status(200).end());e.next=3;break;case 3:return setCorsHeaders(s),r=t.body,a=r.postId,n=r.username,o=r.action,u=r.comment,e.prev=5,e.next=8,regeneratorRuntime.awrap((0,_db.connectToDatabase)());case 8:if("POST"===t.method)return e.next=11,regeneratorRuntime.awrap(Post.findById(a));e.next=44;break;case 11:if(i=e.sent){e.next=14;break}return e.abrupt("return",s.status(404).json({message:"Post not found"}));case 14:if("like"!==o){e.next=23;break}if(i.dislikedBy.includes(n))return e.abrupt("return",s.status(400).json({message:"You cannot like a post you have disliked"}));e.next=17;break;case 17:if(i.likedBy.includes(n))return e.abrupt("return",s.status(400).json({message:"You have already liked this post"}));e.next=19;break;case 19:i.likes+=1,i.likedBy.push(n),e.next=39;break;case 23:if("dislike"!==o){e.next=32;break}if(i.likedBy.includes(n))return e.abrupt("return",s.status(400).json({message:"You cannot dislike a post you have liked"}));e.next=26;break;case 26:if(i.dislikedBy.includes(n))return e.abrupt("return",s.status(400).json({message:"You have already disliked this post"}));e.next=28;break;case 28:i.dislikes+=1,i.dislikedBy.push(n),e.next=39;break;case 32:if("comment"!==o){e.next=38;break}if(u&&u.trim()){e.next=35;break}return e.abrupt("return",s.status(400).json({message:"Comment cannot be empty"}));case 35:i.comments.push({username:n,comment:u,timestamp:new Date}),e.next=39;break;case 38:return e.abrupt("return",s.status(400).json({message:"Invalid action type"}));case 39:return e.next=41,regeneratorRuntime.awrap(i.save());case 41:return e.abrupt("return",s.json(i));case 44:s.status(405).json({message:"Method Not Allowed"});case 45:e.next=51;break;case 47:e.prev=47,e.t0=e.catch(5),console.error(e.t0),s.status(500).json({message:"Error updating post",error:e.t0});case 51:case"end":return e.stop()}},null,null,[[5,47]])}
//# sourceMappingURL=editPost.min.js.map
