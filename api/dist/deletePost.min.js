"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=handler;var _mongoose=_interopRequireDefault(require("mongoose")),_db=require("../utils/db");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var postSchema=new _mongoose.default.Schema({message:String,timestamp:Date,username:String,sessionId:String}),Post=_mongoose.default.model("Post",postSchema),setCorsHeaders=function(e){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type")};function handler(t,s){var r,n,o,a,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if("OPTIONS"===t.method)return setCorsHeaders(s),e.abrupt("return",s.status(200).end());e.next=3;break;case 3:return setCorsHeaders(s),e.next=6,regeneratorRuntime.awrap((0,_db.connectToDatabase)());case 6:if("DELETE"!==t.method){e.next=29;break}if(e.prev=7,r=t.body,n=r.postId,o=r.username,a=r.sessionId,n&&o&&a){e.next=11;break}return e.abrupt("return",s.status(400).json({message:"Missing required fields: postId, username, sessionId"}));case 11:return e.next=13,regeneratorRuntime.awrap(Post.findById(n));case 13:if(u=e.sent){e.next=16;break}return e.abrupt("return",s.status(404).json({message:"Post not found"}));case 16:if(u.username!==o)return e.abrupt("return",s.status(403).json({message:"You can only delete your own posts"}));e.next=18;break;case 18:return e.next=20,regeneratorRuntime.awrap(u.deleteOne());case 20:s.status(200).json({message:"Post deleted successfully"}),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(7),console.error(e.t0),s.status(500).json({message:"Error deleting post",error:e.t0});case 27:e.next=30;break;case 29:s.status(405).json({message:"Method Not Allowed"});case 30:case"end":return e.stop()}},null,null,[[7,23]])}
//# sourceMappingURL=deletePost.min.js.map
